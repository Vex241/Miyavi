-- Miyavi-AK: Muscle Legends Kill All + Server Hop (FULLY WORKING)
-- PlaceId: 3623096087
-- 40 second server hop with proper kill all

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")

-- Configuration
_G.placeId = 3623096087
_G.serverHopDelay = 40 -- 40 seconds
_G.killAllEnabled = true
_G.whitelistedPlayers = {"indieuns_fan"} -- Only indieuns_fan is whitelisted

-- Wait for character
local function getCharacter()
    local char = LocalPlayer.Character
    if not char or not char:FindFirstChild("HumanoidRootPart") then
        char = LocalPlayer.CharacterAdded:Wait()
        char:WaitForChild("HumanoidRootPart")
    end
    return char
end

-- Auto equip punch
local function autoEquipPunch()
    local backpack = LocalPlayer:WaitForChild("Backpack")
    local character = getCharacter()
    local humanoid = character:WaitForChild("Humanoid")
    
    local punch = backpack:FindFirstChild("Punch")
    if punch then
        humanoid:EquipTool(punch)
        return true
    end
    return false
end

-- Server hop function
local function serverHop()
    print("üîÑ Searching for new server...")
    
    local currentJobId = game.JobId
    local success, response = pcall(function()
        local url = string.format("https://games.roblox.com/v1/games/%d/servers/Public?sortOrder=Desc&limit=100", _G.placeId)
        return HttpService:JSONDecode(HttpService:GetAsync(url, true))
    end)
    
    if success and response and response.data then
        local available = {}
        for _, server in ipairs(response.data) do
            if server.id ~= currentJobId and server.playing < server.maxPlayers then
                table.insert(available, server)
            end
        end
        
        if #available > 0 then
            local target = available[math.random(1, #available)]
            print("‚úÖ Teleporting to server: " .. target.id)
            TeleportService:TeleportToPlaceInstance(_G.placeId, target.id, LocalPlayer)
            return
        end
    end
    
    warn("‚ö†Ô∏è Using fallback teleport...")
    TeleportService:Teleport(_G.placeId, LocalPlayer)
end

-- Whitelist check
function isWhitelisted(p176)
    if typeof(p176) == "Instance" and p176:IsA("Player") and p176.Name:lower() == "indieuns_fan" then
        return true
    end
    if typeof(p176) == "string" and p176:lower() == "indieuns_fan" then
        return true
    end
    local v177
    if typeof(p176) ~= "Instance" or not p176:IsA("Player") then
        if typeof(p176) ~= "string" then
            return false
        end
        v177 = p176:lower()
    else
        v177 = p176.Name:lower()
    end
    local v178, v179, v180 = ipairs(_G.whitelistedPlayers)
    while true do
        local v181
        v180, v181 = v178(v179, v180)
        if v180 == nil then
            break
        end
        if v181:lower() == v177 then
            return true
        end
    end
    return false
end

-- Check if player is alive
local function vu208(p206)
    local v207 = p206 and p206.Character and (p206.Character:FindFirstChild("HumanoidRootPart") and p206.Character:FindFirstChild("Humanoid"))
    if v207 then
        v207 = p206.Character.Humanoid.Health > 0
    end
    return v207
end

-- Equip punch tool
local function vu205()
    local v201, v202, v203 = pairs(game.Players.LocalPlayer.Backpack:GetChildren())
    while true do
        local v204
        v203, v204 = v201(v202, v203)
        if v203 == nil then
            break
        end
        if v204.Name == "Punch" and game.Players.LocalPlayer.Character:FindFirstChild("Humanoid") then
            game.Players.LocalPlayer.Character.Humanoid:EquipTool(v204)
        end
    end
end

-- Kill function
local function vu211(pu209)
    if vu208(pu209) then
        local vu210 = getCharacter()
        if vu210 and vu210:FindFirstChild("LeftHand") then
            pcall(function()
                firetouchinterest(pu209.Character.HumanoidRootPart, vu210.LeftHand, 0)
                firetouchinterest(pu209.Character.HumanoidRootPart, vu210.LeftHand, 1)
                vu205()
            end)
        end
    end
end

-- UI
local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/ISPPs54/Ui/refs/heads/main/eeee", true))()
local Window = Library:AddWindow("Miyavi-AK", {
    main_color = Color3.fromRGB(255, 0, 0),
    min_size = Vector2.new(300, 150),
    can_resize = false
})

local MainTab = Window:AddTab("Main")
MainTab:AddLabel("KILL ALL").TextSize = 24

local statusLabel = MainTab:AddLabel("Status: Loading...")
local timerLabel = MainTab:AddLabel(string.format("Hop: %ds", _G.serverHopDelay))

-- Start countdown for server hop
task.spawn(function()
    for i = _G.serverHopDelay, 1, -1 do
        timerLabel.Text = string.format("Hop: %ds", i)
        task.wait(1)
    end
    statusLabel.Text = "üöÄ SERVER HOPPING!"
    serverHop()
end)

-- Main kill loop
task.spawn(function()
    getCharacter()
    autoEquipPunch()
    statusLabel.Text = "‚úÖ Status: Killing All"
    
    -- Create kill connection
    _G.killConnection = game:GetService("RunService").Heartbeat:Connect(function()
        if _G.killAllEnabled then
            for _, player in ipairs(Players:GetPlayers()) do
                if player ~= LocalPlayer and not isWhitelisted(player) then
                    vu211(player)
                end
            end
        end
    end)
end)

-- Handle character respawn
LocalPlayer.CharacterAdded:Connect(function()
    task.wait(1)
    autoEquipPunch()
    statusLabel.Text = "‚úÖ Status: Killing All (Respawned)"
end)

-- Anti-AFK
local VirtualUser = game:GetService("VirtualUser")
LocalPlayer.Idled:Connect(function()
    VirtualUser:CaptureController()
    VirtualUser:ClickButton2(Vector2.new())
end)

print("‚úÖ Miyavi-AK Loaded")
print("üéØ Kill All: ACTIVE (kills everyone except indieuns_fan)")
print("‚è±Ô∏è Server Hop: " .. _G.serverHopDelay .. " seconds")
print("üîß Auto-Equip: ENABLED")
