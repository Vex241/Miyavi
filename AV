-- Miyavi-AK: Muscle Legends Kill All + Server Hop (FULLY WORKING)
-- PlaceId: 3623096087
-- Enhanced with Auto Punch, Fast Punch & JamJam Server Hop

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")
local RunService = game:GetService("RunService")

-- Configuration
_G.placeId = 3623096087
_G.serverHopDelay = 40 -- 40 seconds
_G.killAllEnabled = true
_G.whitelistedPlayers = {"indieuns_fan"} -- Only indieuns_fan is whitelisted
_G.autoPunchEnabled = false -- Auto spam punch
_G.fastPunchEnabled = false -- Remove cooldowns & rapid fire

-- Server Hop Variables (JamJam's Implementation)
local AllIDs = {}
local foundAnything = ""
local actualHour = os.date("!*t").hour

-- Load saved server IDs
local File = pcall(function()
    AllIDs = HttpService:JSONDecode(readfile("NotSameServers.json"))
end)

if not File then
    table.insert(AllIDs, actualHour)
    writefile("NotSameServers.json", HttpService:JSONEncode(AllIDs))
end

-- Wait for character
local function getCharacter()
    local char = LocalPlayer.Character
    if not char or not char:FindFirstChild("HumanoidRootPart") then
        char = LocalPlayer.CharacterAdded:Wait()
        char:WaitForChild("HumanoidRootPart")
    end
    return char
end

-- JamJam's Server Hop Implementation
local function TPReturner()
    local Site
    if foundAnything == "" then
        Site = HttpService:JSONDecode(game:HttpGet('https://games.roblox.com/v1/games/' .. _G.placeId .. '/servers/Public?sortOrder=Asc&limit=100'))
    else
        Site = HttpService:JSONDecode(game:HttpGet('https://games.roblox.com/v1/games/' .. _G.placeId .. '/servers/Public?sortOrder=Asc&limit=100&cursor=' .. foundAnything))
    end

    local ID = ""
    if Site.nextPageCursor and Site.nextPageCursor ~= "null" and Site.nextPageCursor ~= nil then
        foundAnything = Site.nextPageCursor
    end

    local num = 0
    for i, v in pairs(Site.data) do
        local Possible = true
        ID = tostring(v.id)
        if tonumber(v.maxPlayers) > tonumber(v.playing) then
            for _, Existing in pairs(AllIDs) do
                if num ~= 0 then
                    if ID == tostring(Existing) then
                        Possible = false
                    end
                else
                    if tonumber(actualHour) ~= tonumber(Existing) then
                        local delFile = pcall(function()
                            delfile("NotSameServers.json")
                            AllIDs = {}
                            table.insert(AllIDs, actualHour)
                        end)
                    end
                end
                num = num + 1
            end
            if Possible == true then
                table.insert(AllIDs, ID)
                wait()
                pcall(function()
                    writefile("NotSameServers.json", HttpService:JSONEncode(AllIDs))
                    wait()
                    TeleportService:TeleportToPlaceInstance(_G.placeId, ID, LocalPlayer)
                end)
                wait(4)
            end
        end
    end
end

local function serverHop()
    print("üîÑ Searching for new server...")
    TPReturner()
    if foundAnything ~= "" then
        TPReturner()
    end
end

-- Start server hop countdown
local function startServerHop()
    task.spawn(function()
        for i = _G.serverHopDelay, 1, -1 do
            if timerLabel then
                timerLabel.Text = string.format("Hop: %ds", i)
            end
            task.wait(1)
        end
        if statusLabel then
            statusLabel.Text = "üöÄ SERVER HOPPING!"
        end
        serverHop()
    end)
end

-- Whitelist check
function isWhitelisted(p176)
    if typeof(p176) == "Instance" and p176:IsA("Player") and p176.Name:lower() == "indieuns_fan" then
        return true
    end
    if typeof(p176) == "string" and p176:lower() == "indieuns_fan" then
        return true
    end
    local v177
    if typeof(p176) ~= "Instance" or not p176:IsA("Player") then
        if typeof(p176) ~= "string" then
            return false
        end
        v177 = p176:lower()
    else
        v177 = p176.Name:lower()
    end
    local v178, v179, v180 = ipairs(_G.whitelistedPlayers)
    while true do
        local v181
        v180, v181 = v178(v179, v180)
        if v180 == nil then
            break
        end
        if v181:lower() == v177 then
            return true
        end
    end
    return false
end

-- Check if player is alive
local function vu208(p206)
    local v207 = p206 and p206.Character and (p206.Character:FindFirstChild("HumanoidRootPart") and p206.Character:FindFirstChild("Humanoid"))
    if v207 then
        v207 = p206.Character.Humanoid.Health > 0
    end
    return v207
end

-- Equip punch tool
local function vu205()
    local v201, v202, v203 = pairs(game.Players.LocalPlayer.Backpack:GetChildren())
    while true do
        local v204
        v203, v204 = v201(v202, v203)
        if v203 == nil then
            break
        end
        if v204.Name == "Punch" and game.Players.LocalPlayer.Character:FindFirstChild("Humanoid") then
            game.Players.LocalPlayer.Character.Humanoid:EquipTool(v204)
        end
    end
end

-- Kill function with auto/fast punch
local function vu211(pu209)
    if vu208(pu209) then
        local vu210 = getCharacter()
        if vu210 and vu210:FindFirstChild("LeftHand") then
            pcall(function()
                -- Auto punch integration
                if _G.autoPunchEnabled then
                    vu205()
                end
                
                -- Fast punch - spam multiple times
                if _G.fastPunchEnabled then
                    for i = 1, 3 do
                        firetouchinterest(pu209.Character.HumanoidRootPart, vu210.LeftHand, 0)
                        firetouchinterest(pu209.Character.HumanoidRootPart, vu210.LeftHand, 1)
                        task.wait(0.01)
                    end
                else
                    firetouchinterest(pu209.Character.HumanoidRootPart, vu210.LeftHand, 0)
                    firetouchinterest(pu209.Character.HumanoidRootPart, vu210.LeftHand, 1)
                end
                
                if _G.autoPunchEnabled then
                    vu205()
                end
            end)
        end
    end
end

-- UI
local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/ISPPs54/Ui/refs/heads/main/eeee", true))()
local Window = Library:AddWindow("Miyavi-AK Enhanced", {
    main_color = Color3.fromRGB(255, 0, 0),
    min_size = Vector2.new(350, 250),
    can_resize = false
})

local MainTab = Window:AddTab("Main")
MainTab:AddLabel("KILL ALL").TextSize = 24

local statusLabel = MainTab:AddLabel("Status: Loading...")
local timerLabel = MainTab:AddLabel(string.format("Hop: %ds", _G.serverHopDelay))

-- Auto Punch toggle
local autoPunchToggle = MainTab:AddSwitch("Auto Punch", function(enabled)
    _G.autoPunchEnabled = enabled
    statusLabel.Text = "‚úÖ Auto Punch: " .. (enabled and "ON" or "OFF")
end, false)

-- Fast Punch toggle
local fastPunchToggle = MainTab:AddSwitch("Fast Punch", function(enabled)
    _G.fastPunchEnabled = enabled
    statusLabel.Text = "‚úÖ Fast Punch: " .. (enabled and "ON" or "OFF")
end, false)

-- Start countdown for server hop
startServerHop()

-- Main kill loop
task.spawn(function()
    getCharacter()
    autoEquipPunch()
    statusLabel.Text = "‚úÖ Status: Killing All"
    
    -- Create kill connection
    _G.killConnection = RunService.Heartbeat:Connect(function()
        if _G.killAllEnabled then
            for _, player in ipairs(Players:GetPlayers()) do
                if player ~= LocalPlayer and not isWhitelisted(player) then
                    vu211(player)
                end
            end
        end
    end)
end)

-- Handle character respawn
LocalPlayer.CharacterAdded:Connect(function()
    task.wait(1)
    autoEquipPunch()
    statusLabel.Text = "‚úÖ Status: Killing All (Respawned)"
end)

-- Anti-AFK
local VirtualUser = game:GetService("VirtualUser")
LocalPlayer.Idled:Connect(function()
    VirtualUser:CaptureController()
    VirtualUser:ClickButton2(Vector2.new())
end)

print("‚úÖ Miyavi-AK Enhanced Loaded")
print("üéØ Kill All: ACTIVE (kills everyone except indieuns_fan)")
print("üëä Auto Punch: " .. tostring(_G.autoPunchEnabled))
print("‚ö° Fast Punch: " .. tostring(_G.fastPunchEnabled))
print("‚è±Ô∏è Server Hop: " .. _G.serverHopDelay .. " seconds")
print("üîß Enhanced Server Hop: ENABLED (JamJam's Version)")
